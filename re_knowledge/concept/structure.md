<div style="float: left; width: 64%; padding: 1%;">

### 操作系统结构
<ul>

#### 背景
<ul>
- 操作系统功能不断增多
- 代码规模不断扩大
- 合理结构的重要性
  - 降低操作系统复杂度
  - 提升操作系统安全与可靠性

</ul>

#### 分层法
<ul>

##### 基本概念
- 操作系统分为若干层
  - 底层(层0)为硬件
  - 顶层(层N)为用户接口
  - 每层只能调用紧邻低层的功能和服务(单向依赖)

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/81bbbd88798a995473d2b6d27deb4a915fcfcbafc635c31bcc01aff7f13f3a14.jpg)  
图1.4分层的操作系统  

##### 优点
- 便于系统调试和验证
  - 简化系统设计和实现
  - 逐层调试验证
  - 错误定位容易
- 易扩充和维护
  - 模块增删改不影响其他层
  - 保持接口不变即可

##### 问题
- 合理定义各层困难
  - 依赖关系固定后不够灵活
- 效率较差
  - 功能执行需穿越多层
  - 层间通信机制增加开销

</ul>

#### 模块化
<ul>

##### 基本概念
- 按功能划分为独立模块
- 规定模块间接口
- 通过接口进行通信
- 可细分为子模块

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/66329b0f96d29e529b392be4dd0882f9c485466dfcef3858e75c9ac55e961c55.jpg)  
图1.5由模块、子模块等组成的模块化操作系统结构  

##### 模块划分考虑
- 模块大小权衡
  - 太小：模块间联系过多
  - 太大：内部复杂性增加
- 模块独立性标准
  - 内聚性：模块内部联系紧密程度
  - 耦合度：模块间相互影响程度

##### 优缺点
###### 优点
- 提高系统设计质量
  - 正确性
  - 可理解性
  - 可维护性
- 增强可适应性
- 加速开发过程

###### 缺点
- 接口规定难满足实际需求
- 设计决策顺序难确定

</ul>

#### 宏内核
<ul>

##### 基本概念
- 主要功能模块在核心态运行
- 为用户程序提供高性能服务
- 管理模块间共享信息

##### 发展现状
- 主流地位
  - Windows、Android、iOS等采用
- 面临挑战
  - 系统服务复杂化
  - 设计规模增长
  - 软件危机困境

##### 与微内核关系
- 同步发展
- 形成混合内核
  - 吸收微内核优点
  - 融合成新架构
- 未来趋势
  - 微内核优势显现
  - Fuchsia和鸿蒙OS采用微内核
</ul>

</ul>

## 微内核  

<ul>

### 基本概念  

<ul>

#### 定义
- 将内核中最基本的功能保留在内核
- 不需要在核心态执行的功能移到用户态执行
- 降低内核的设计复杂性
- 移出内核的操作系统代码
  - 按分层原则划分为若干服务程序
  - 执行相互独立
  - 通过微内核进行通信

#### 结构组成
- 微内核和多个服务器构成
- 微内核包含
  - $\textcircled{\scriptsize{1}}$ 与硬件处理紧密相关的部分
  - $\textcircled{2}$ 一些较基本的功能
  - $\textcircled{3}$ 客户和服务器之间的通信
- 大部分功能在微内核外服务器中实现
  - 作为进程运行在用户态
  - 通过消息传递机制交互

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8a2da0b5134ea9c29a2947ba9281d8adcfa2f6cfc1e46a2266262f4d7a0725ec.jpg)  
图1.6单机环境下的客户/服务器模式  

#### 运行方式
- 只有微内核运行在内核态
- 其余模块运行在用户态
- 错误隔离机制
  - 单模块错误只导致该模块崩溃
  - 不影响整个系统

</ul>

### 基本功能  

<ul>

#### 设计原则
- 利用"机制与策略分离"原理
- 机制部分和硬件相关部分放入微内核

#### 核心功能
##### 进程管理
- 进程通信功能
- 进程切换和调度
- 多处理机同步
- 机制与策略分离示例
  - 机制：优先级队列设置
  - 策略：进程分类和优先级确定

##### 存储器管理
- 基本机制
  - 页表机制
  - 地址变换机制
- 策略部分放在外部服务器
  - 页面置换算法
  - 内存分配回收策略

##### 中断处理
- 捕获中断和陷入事件
- 进行中断响应
- 转发给相关服务器

</ul>

### 特点  

<ul>

>pro：微内核操作系统的特点（2023）  

#### 优点
- $\textcircled{\scriptsize{1}}$ 扩展性和灵活性
  - 功能模块化分离
  - 易于修改和增加功能
- $\circledcirc$ 可靠性和安全性
- $\textcircled{3}$ 可移植性
  - 硬件相关代码集中在内核
  - 服务器与平台无关
- $\textcircled{4})$ 分布式计算支持
  - 基于消息传递机制
  - 适合分布式和网络系统

#### 缺点
- 性能问题
  - 频繁模式切换
  - 执行开销大
- 改进措施
  - 常用服务移回内核
  - 但会增加内核体积

#### 应用领域
- 实时系统
- 工业应用
- 航空军事
- 关键任务系统

</ul>

</ul>

## 外核  

<ul>

### 基本原理
<ul>
- 资源划分策略
  - 给每个用户分配资源子集
  - 例如磁盘块分配

</ul>

### 核心功能
<ul>
- 运行在内核态
- 资源分配
- 使用安全检查
- 虚拟机限制管理

</ul>

### 优势
<ul>
- 减少资源映射层
- 简化重映射处理
- 分离多道程序和用户操作系统代码
- 负载较轻

</ul>
</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
