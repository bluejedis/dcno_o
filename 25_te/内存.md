## 内存
- concept
    - type
        - **存储管理**          
            - 目标
                - 为p分配/回收被p release 内存空间
                    - ↑物理v不可变
            - 编译→link→装入
                - 编译
                    - 编译后 地址
                        - 编号由0始
                        - called as 逻辑地址
                - link
                    - 逻辑addr → 物理addr
            - 重定位
                - 静态
                    - 提前计算
                    - program加载时 change一次
                        - 固定分区suite
                - 动态
                    - >only one重定位寄存器(基址R
                        - 每次保存&恢复 该R的值
                    - 执行过程中 进行
                        - 程序装入后，in内存still might移动
                    - depending on
                        - 可重定位装入(可重入) 程序
                            - decline对换数量
                                - ↑through 减少程序段 调入调出
                                    - share same存储空间
                                    - or 动态链接 程序 --映射→进程
                        - 基址R
                        - 地址变换机构
            - --
            - 地址
                - 转换
                    -  地址变换机构
                        - >MMU
                    - **逻辑→物理**
                        - 按号 find 段首址
                            - 比较长 与 段长度
                            - eg.(2,154)
                                - 2→480k
                                    - 154＜20k
                                    - ∴480+154
                        - link: 页表存储同理
                            - >物理地址单位为B？
                                - ↑对主存'visit 以B/bit为单位
        - **内存保护**
            - >硬&软(os)配合
            - apply
                - 多线程互不干扰
                    - 如：页/段 地址越界保护
                        - ↑through界地址R
                            - 地址越界：
                                - p运行产生'地址 in地址空间之外
- -- 
- 4ways
    - 连续分配
        - **分区**
            - >代价最小
            - 固定..
                - >内piece
                - >大小can不同, but 需 预先固定
            - 动态(可变)..
                - >装入时创建
                - 空闲分区数-1 的情况
                    - 合并时 上下皆有
                    - ↑ 拼接技术
                    - ？67 为什么是1、4区合并
        - 用户
            - 单用户连续分配
                - only suite 单用户/任务/os←not多道
        - 4fit
            - >基于顺序搜索
                - link：基于索引搜索
                    - 快速适应，伙伴，哈希
            - 首次
            - 最佳
                - >need空闲区链排序
                    - 按长度递增
                - >大小接近
                    - 最易produce 内存piece
            - 最坏
                - >..排序
            - --
            - 邻近
    - --
    - 分页
        - >内piece
            - >提高利用率
        - >硬件、os可见
            - others上层不可见(透明
        - element
            - 页表
                - >由os产生
                    - 查找页表由硬件负责
                - 地址
                    - 始地址 stored in
                        - 页表R
                - --
                - 不同页表→same页帧
                    - 可实现
                        - 可重入代码' 共享
                        - 内存复制
                            - ↑change页表项
                        - 进程通信
                - --
                - 多级页表
                    - 优
                        - decline 页表 所占连续存储空间
                    - 页表基址R
                        - 存放：
                            - 顶级页表' 起始物理地址
                                - ↑顶级 即1级？
                    - count
                        -  use几级
                            - $\frac{页表索引 总size位数(页号数)}{..一级size位数}$
                                - 总
                                    - =总逻辑地址位数-页偏移量位数
                                        - ↑页号位数=$log_2{页面大小}$
                                - 一级
                                    - =$\frac{页面size}{页表项size}$
                        - - -
                            - ？63
                        - --
                            - 采用**二级页表**时
                                - 页目录号、页号 ？69
            - --
            - 页面
                - >must等长
                - 划分size
                    - >计算后决定
                    - 大，页表少，piece大
                    - 小，..大，..小
                - 整数倍地址
                    - 开始存放
                        - ↑页面in物理内存
                - --
            - 页框
                - >即 物理address
                - 主存分配'基本单位
            - **TLB**
                - >as高速缓冲 存储器
                    - ∴普通页表 即慢表
                - 关闭后，每条指令or存取一个操作数 访存2次
                    - 先页表(内存中) get物理地址
                    - 再visit一次内存进行相应操作
                        - ↑CPU从内存取一次数据
                            - 页表的访存次数取决于页表的层级结构。如果页表划分为N级，则需要访问内存N+1次。
                            - if TLB命中，only访问1次内存
                - link：
                    - 地址变换机构
                        - >逻辑→物理
                            - 页表R
                        - have TLB' 地址变换机构
                - --
            - count
                - >kB=$2^{10}$B
                    - MB=$2^{20}$B
                    - GB=$2^{30}$B
                    - TB=$2^{40}$B
                - 主存
                    - 容量
                        - $2^{总长}$
                            - eg.$2^{18}$
                    - 可分页数
                        - 总/页size
                            - **页size**=页偏移量 ←见页面大小，求页偏移量
                                - =$2^{偏移量 位数}$
                                    - eg.$2^{11}$
                        - or =页号
                            - =$2^{页号 位数}$
                                - eg.$2^7$
                    - 指令
                        - 物理地址
                            - compare相对地址with页size
                                - ＜
                                    - 之前块数+相对地址
                                        - eg.放入2号块
                                            - 2*块数 + 1500
                                - ＞
                                    - 之前块数+1+(相对地址-1)
                                        - ↑？不是一样的吗
                        - 指令数据所在页号
                            - compare指令中位数with页size
                                - ＞
                                    - 指令块号+"1"
                                - eg."store rl,2500”
                                    - 2500＞2048
                                    - 2+1
                    - 始址
                        - ？56题，为什么不加0、1号页框size
                    - --
                        
            - --
            - 物理地址space
                - 总-页表
                    - ↑段
                        - 总-段表
    - **分段**
        - >外部piece
        - 对 程序员(低级语言)、编译器**可见**
            - ↑透明即不可见？
        - >goal：
            - 方便编程、共享保护、动态link
                - ↑discern：离散分配、improve利用率
                    - ↑分页
        - --
        - 分段：
            - user编程
                - **程序** 按逻辑 划分
                - ↑∴分段存储 有利于 program动态链接
            - 以 段 为单位
                - 长不定(可等)← 可变长
                    - 段内
                        - 连续
                    - 之间
                        - 可独立or连续
        - element：
            - 段表
                - **1p 1段表**
                    - ↑whatever p有多少段
                    - ∴段页式 1p1段表
                        - 1段1页表
                        - discern：
                            - 分页式
                                - 1p 1页表 &p'页表 驻留in内存
                - **共享..**
                    - >段表中相应表项--指向→ 被共享的段' same物理副本
                        - ∴逻辑段号might不同
                            - eg. 页号 与 页框同理
                                - 2p页号不一定equal，页框must
                    - 多p share same 代码or数据
                        - eg.进程p1 p2共享 段s
                            - 仅保存一份段S的内容 in 物理内存
                                - --
                            - 逻辑段号might不同
                                - --
                            - P1和P2
                                - 共享
                                    - 段S在共享段表中的段表项
                                - both不再使用段S时才回收段S所占的内存空间
        - --
        - 操作
            - cpu从内存取一次data
                - 访存次数：2
                    - ↑查 段表+拼成物理地址visit内存
                - compared to
                    - 段页表：3
                    - ↑ 查 段表 + 查页表 ..
                    - discern
                        - 页表：N+1
         - 地址结构：
             - 二维
                 - 段之间独立&段长不定
                     - need 段名&段内地址
                 - ∴ 段页式also
             - discern
                 - 页式
                     - 一维
                     - ↑单一线性(页长固定)
    - --
    - 段页
        - >内piece
        - 原理
            - 分段
                - 用户地址空间
            - 分页
                - 管理 物理存储space
 ---
动态重定位 与 动态分区、作业装入的联系？
始址为什么 不加前？53
多级页表？(left
- 正反求
    - 58与63 68'通式
---
---
## 虚拟内存
- >need 硬件&软件 支持
    - **请求**机制
        - ↑基于页or段or段页 从内存的调入/调出
        - ↑离散分配(非连续分配技术)
---
- 页
    - **请求**分页
        - 虚拟存储管理
            - >补充逻辑空间←（间接)扩充了内存
                - based on **局部性**原理
                -  无 一次性、驻留性
                    - ↑与 基本分页的区别
            - 特征：
                - 多次 对换 虚拟
            - 动态链接
                - ↑？除了固定分区，其他方式应该都是动态吧
        - max容量
            - only由地址结构决定 (←与主存、外存无关
                - ↑即地址R位数
                    - eg.$2^{32}$
        - --
        - 缺页
            - 没有对应page
        - ==缺页中断==
            - >页表对应状态位(有效位)A=0
                - 
                - os接管，去硬盘search对应页
            - --
            - 次数
                - 对于顺序执行
                    - =**页帧**数
                        - ↑ 页帧=页框=内存块
                            - = **物理块**，物理页
                - --
                - 由 数组code judge
                    - >int 占 4B
                        - 1字 according to题目要求取
                    - judge 数组行数size with 页框size
                        - ↑按行优先
                        - ？计算模板是什么？为什么11题一个页框能存储，还会中断？(11、12
                - --
                - 页面置换
                    - >whatever算法，每种页面第一次访问时不可能在内存中"
                        - ↑内存满了&&没有需要的页，才进行调度算法
                    - type：
                        - 最佳置换
                        - FIFO
                            - 可分配 页数↑
                                - 缺页中断次数 可能↑ or ↓
                                    - Belady异常
                                - discern：
                                    - 页帧数 与 页数
                        - LRU
                            - 失效次数
                                - =**缺页**中断发生次数
                                    - ↑只要缺页 就会有中断
                                        - ∴缺页中断发生：物理块中缺页 + 置换发生时
                                            - ↑ 缺页发生，不一定淘汰(内存中有余位
                                        - eg.![Screenshot_2025-10-08-13-51-55-632_cn](https://bluejedis.github.io/picx-images-hosting/OS/Screenshot_2025-10-08-13-51-55-632_cn.wps.moffice_eng-edit.64e8k0rdi1.webp)
                            - 耗费高
                                - need对访问time 记录+排序
                        - clock
                            - 地址变换
                                <a id="section1"></a>
                                - ？ 16进制虚拟→物理(55题
            - --
        - 虚拟地址
            - >程序访问内存时use
                - ↑count页表项时，only与虚拟地址有关
                    - 与物理address无
            - --
            - element
                - 页表
                    - >见页面大小 count 页内偏移 占位
                        - 总地址- 偏移量占位=页号
                    - 由16进制逻辑地址 求物理
                        - >16→2
                        - ？19题 具体展开
                            - lock相关相似题 [见上](#section1)
                    - --
                    - 页面大小
                        - 页面越小
                            - 页表项数量越多
                                - 页表所占的空间就更大
                                - 缺页率越高
                                - IO操作更频繁
                            - 浪费的空间越少，内存利用率越高
                    ---
                    - TLB
                        - 平均访存时间
                            - =命中率×TLB时间+not命中率×(TLB时间+页表时间)+ 内存访问时间
                                - ↑页表t=内存访问t
                            - --
                        - 提高命中率
                            - 加大
                                - TLB容量
                                - 页面大小
                                    - ↑ 用较少的页面覆盖更大的地址空间，从而减少页表项，<span style="color:lightgray">因此可以提高TLB命中率</span>
                                        - 增大表项，则降低
                                        - 多级页表 无关

    - --
    - 页框分配
        - 驻留集
            - >已装入内存的页面的集合

                - discern：工作集
                    - p need访问的页面的集合 (in某段时间
        - --
        - 性能judge
            - 交换空间的磁盘利用率high，else低
                - 增加性能or提高cpu利用率
                - ↑加内存or减少多道程序度数
        - --
    - 页面**置换算法**
        - >参考修改位 和 访问位
            - 磁盘 与 内存的交换
                - not cpu 与 内存的交换
        - 全局置换
            - 不受**驻留集**限制 ←分配过'page 还能again
                - ∴ 不可能与 固定分配共存
- - -
- element
    - 抖动、工作集
        - 抖动
            - 频繁置换
                - >all置换算法 皆有可能
            - 消除：
                - **工作集**页面 in**内存**中
                    - 则不会产生缺页中断，即不会出现页面的调入/调出
                    - not 虚拟存储器(including作为虚拟内存那部分硬盘
            - --
        - 工作集
            - 窗口大小k
                - ↑存储最近k次 & 去重
    - --
    - 内存映射文件
        - 特点：
            - 让p按 读写内存的way 读写文件
                - ↑through 让文件映射到虚拟地址空间
            - 按需加载
            - 可多p 映射/共享 same文件
                - --
                <a id="sectionlink"></a>
                - file表项相关
                    - 打开file
                        - 可同时 以r/w 打开
                    - 打开文件表
                        - only 1 表项
                            - 包含属性
                                - ↑ 只有一个system 打开表项
                                - 同一file 多次open
                                    - change 引用计数
                                        - ↑关闭时
                                            - 1p关闭, 计数-1
                                            - till 计数=0
                                                - 删除表项
                                                    - ↑若仅1p，直接=0
                                                        - 文件system：
                                                            - 释放 F索引node所占**内存**空间
                                                                - ↑不改变磁盘索引node
                                                        - --
                                                    - **关闭**file，不会删除 对应目录项
                        - 表项内容
                            - 各user 不一定same
                                - ↑权限不同
        - --
    - 性能(缺页率)影响因素
        - 因素：
            - 置换算法
            - 工作集size
            - p数量
        - no
            - 缓冲队列长度
                - ↑放置淘汰page
- --
- 转换
    - 地址翻译
- --
tip：每类资源都有调度算法
一般 加大交换区 无效
缺页中断次数←code(left
- 原理？
16进制地址 逻辑→物理
- 过程
