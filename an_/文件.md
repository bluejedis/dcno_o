<div style="float: left; width: 64%; padding: 1%;">

好的，各位同学，我们来到第四章《文件管理》。这是操作系统三大核心的最后一章，相比进程和内存，文件管理的概念更加具体，与我们日常使用电脑的操作息息相关。本章的考点集中在**文件物理结构**、**目录管理**和**磁盘空间管理**上，计算题模式固定，概念题重在理解。

---

### **第4章 文件管理**

本章我们要扮演一个“图书管理员”，搞清楚计算机是如何管理硬盘上成千上万个文件的。核心是解决两个问题：文件内部数据怎么组织（逻辑与物理结构），以及文件之间怎么组织（目录）。

---

#### **4.1 文件系统基础**

##### **4.1.1 文件的基本概念**

* **核心考点:**
    * 文件的定义、属性。
* **形象记忆法:**
    * **文件系统 = 图书馆**
    * **文件 = 书**
    * **文件内容 = 书的正文**
    * **文件属性 = 书的版权页** (书名、作者、出版社、ISBN号等)。
        * **名称:** 唯一标识符。
        * **类型:** .txt, .jpg, .exe...
        * **位置:** 文件在硬盘上的存放地址。
        * **大小:** 文件占了多少空间。
        * **保护:** 谁能读、谁能写。
        * **时间:** 创建、最后修改、最后访问的时间。

##### **4.1.2 文件控制块 (FCB) 和索引节点 (inode)**

* **核心考点:**
    * FCB的作用。
    * 索引节点 (inode) 对FCB的改进。
* **形象记忆法:**
    * **FCB (文件控制块) = 图书的索引卡片**
        * **内容:** 包含了文件所有的元数据（文件名、属性、物理地址等）。
        * **存放:** 所有的FCB集合在一起，就形成了**文件目录**。
        * **缺点:** 如果目录里文件很多，每张卡片信息又全又大，找一本书（文件）就要翻很久的卡片，效率低。
    * **索引节点 (inode):** **卡片瘦身术**
        * **思想:** 把文件名和其它信息分开。
        * **目录项:** 只存放 `文件名` + `索引节点编号 (inode号)`。目录项变得很小。
        * **inode表:** 单独存放所有`inode`，每个`inode`包含了除文件名外的所有其它文件属性。
        * **优点:** 目录检索速度大大加快，因为现在只需要在一个小本子（目录文件）里根据文件名找到编号，再去对应的仓库（inode表）里取详细信息。

##### **4.1.3 文件的操作**

* **核心考点:**
    * 基本文件操作。
    * 文件`打开(open)`和`关闭(close)`的内部过程，以及`文件描述符`的作用。
* **形象记忆法 (图书馆借书):**
    * **基本操作:**
        * `create`: 办一张新的索引卡片，找个空书架。
        * `delete`: 撕掉索引卡片，回收书架。
        * `read/write`: 读/写书的内容。
    * **`open`操作 (借书流程):**
        1.  用户提供**文件名** (书名)，发起`open`请求。
        2.  操作系统（图书管理员）根据书名去**目录**（总索引卡）里查找，找到对应FCB/inode。
        3.  管理员把这张卡片的信息复制到内存里的“**打开文件表**”（今日借阅登记表）中。
        4.  管理员返还给用户一个**数字**，叫**文件描述符** (借书证上的编号)。
    * **`close`操作 (还书流程):**
        * 用户提供**文件描述符**，系统根据编号找到“打开文件表”中的条目，释放它，并将可能已修改的元数据写回磁盘。
    * **为什么需要`open`/`close`?**
        * 后续的`read/write`操作，用户只需提供**文件描述符**（一个数字），系统直接查内存里的“打开文件表”即可，**无需每次都去硬盘上遍历目录**，极大提高了效率。

##### **4.1.5 文件的逻辑结构**

* **核心考点:**
    * 文件的两种逻辑结构。
* **形象记忆法 (用户视角):**
    * **无结构文件 (流式文件):** 文件就是一长串字符流。如 `.txt` 文件。想找特定内容？从头读到尾。
    * **有结构文件 (记录式文件):** 文件由一个个记录组成。如数据库文件，每条记录都是一个学生的信息。

##### **4.1.6 文件的物理结构**

* **核心考点:**
    * 三种文件分配方式（物理结构）的原理、优缺点对比（**选择题、大题高频**）。
    * **索引分配的文件大小计算 (大题核心)**。
* **形象记忆法 (硬盘上如何存放文件):**
    * **连续分配:**
        * **原理:** 文件必须存放在**连续**的磁盘块上。
        * **优点:** 顺序读写速度极快（磁头不用动）。
        * **缺点:** 容易产生**外部碎片**；文件创建时必须知道大小，不易扩展。
    * **链接分配:**
        * **原理:** 文件存放在**离散**的盘块里，每个盘块都有一个**指针**指向下一个盘块。
        * **优点:** 无外部碎片，文件易于扩展。
        * **缺点:** **只支持顺序访问**，不支持随机访问（想访问第100块，必须先访问前99块）；指针占用空间；一个指针损坏，整个文件报销。
        * **FAT表 (显式链接):** 把所有指针集中存放在内存的**文件分配表 (FAT)** 中，解决了随机访问慢和可靠性问题。
    * **索引分配:**
        * **原理:** 为每个文件创建一个**索引块**，这个索引块就是一个“地址目录”，里面存放了文件数据所在的所有盘块的地址。
        * **优点:** **支持随机访问**，无外部碎片，文件易于扩展。
        * **缺点:** 索引块本身要占用磁盘空间。
* **计算题模板 (混合索引文件最大容量):**
    * **场景:** UNIX系统中，一个inode有13个地址项`i.addr[0]~i.addr[12]`。
        * `0-9`: 10个**直接地址**。
        * `10`: 1个**一级间接地址**。
        * `11`: 1个**二级间接地址**。
        * `12`: 1个**三级间接地址**。
    * **已知条件:** 磁盘块大小 `B` (如 4KB)，地址项大小 `P` (如 4B)。
    * **计算步骤:**
        1.  **一个索引块能存多少地址:** `N = B / P` (如 `4KB/4B = 1024`)。
        2.  **计算各级索引能表示的文件大小:**
            * **直接地址:** `大小_直 = 10 * B`
            * **一级间接:** `大小_一 = N * B`
            * **二级间接:** `大小_二 = N * N * B = N² * B`
            * **三级间接:** `大小_三 = N * N * N * B = N³ * B`
        3.  **计算最大文件大小:**
            * `最大容量 = 大小_直 + 大小_一 + 大小_二 + 大小_三`

---

#### **4.2 目录**

##### **4.2.2 目录结构**

* **核心考点:**
    * 单级、两级、树形目录结构的特点。
* **形象记忆法:**
    * **单级目录:** 整个系统只有**一个大文件夹**，所有文件都放里面。**缺点:** 文件重名、查找慢。
    * **两级目录:** **一个主文件夹**，下面为**每个用户**创建一个专属文件夹。**解决了重名问题**。
    * **树形目录:** **文件夹里可以套文件夹**。层次清晰，分类方便。现代OS都用这个。
        * **绝对路径:** 从根目录 `/` 开始的完整路径。
        * **相对路径:** 从当前工作目录开始的路径。

##### **4.2.5 文件共享**

* **核心考点:**
    * 硬链接和软链接（符号链接）的实现原理和区别（**选择题高频**）。
* **形象记忆法:**
    * **硬链接 (Hard Link):**
        * **原理:** 多个目录项中的**inode号**指向**同一个inode**。
        * **类比:** 给一本书起了两个不同的书名，但它们指向的是图书馆里**同一本实体书**。
        * **特点:**
            * inode中有一个**链接计数 (link count)**，记录有多少个硬链接指向它。
            * 删除文件时，只是删除目录项，`link count--`。只有当 `link count` 变为0时，才真正删除文件数据。
            * **不能跨文件系统，不能链接目录**。
    * **软链接 (Symbolic Link):**
        * **原理:** 创建一个**特殊的文件**，文件内容是**另一个文件的路径名**。
        * **类比:** Windows的“**快捷方式**”。
        * **特点:**
            * 它有自己独立的inode。
            * 删除**源文件**后，软链接**失效** (悬空指针)。
            * **可以跨文件系统，可以链接目录**。

---

#### **4.3 文件系统**

##### **4.3.1 - 4.3.2 文件系统结构与布局**

* **核心考点:**
    * 文件系统在磁盘上的整体布局。
* **形象记忆法 (磁盘分区蓝图):**
    1.  **引导块 (Boot Block):** 分区的“启动器”，存放启动该分区OS的代码。
    2.  **超级块 (Super Block):** 分区的“说明书”，记录整个文件系统的核心信息（块大小、inode数量、空闲块信息等）。**超级块损坏，文件系统就崩溃**。
    3.  **空闲空间管理区:** 记录哪些盘块是空闲的（如位示图）。
    4.  **inode区:** 集中存放所有文件的inode。
    5.  **数据区:** 存放所有文件的实际数据。

##### **4.3.3 外存空闲空间管理**

* **核心考点:**
    * 位示图法的原理和计算。
* **形象记忆法:**
    * **位示图 (Bitmap):** 用一个二进制位串来表示所有磁盘块。
        * `0` 代表该块**空闲**。
        * `1` 代表该块**已占用**。
        * **优点:** 查找连续的空闲块非常方便。
* **计算题模板 (位示图定位):**
    * **已知条件:** 磁盘块号 `i` (注意题目说明是从0还是1开始)。`w` 为每行/每字的位数 (如32)。
    * **假设从0开始编号:**
        * 它在位示图的第 `j` 行 (字): `j = i / w`
        * 在第 `j` 行的第 `k` 位: `k = i % w`
    * **假设从1开始编号:**
        * 它在位示图的第 `j` 行 (字): `j = (i - 1) / w`
        * 在第 `j` 行的第 `k` 位: `k = (i - 1) % w`

##### **4.3.4 虚拟文件系统 (VFS)**

* **核心考点:**
    * VFS的作用。
* **形象记忆法:**
    * **VFS = 标准化接口/翻译官**
    * **作用:** Linux/Windows等系统支持多种文件系统（如FAT32, NTFS, EXT4）。VFS提供了一个**统一的、抽象的接口**。用户程序的所有文件操作都先发给VFS，VFS再根据具体的文件系统类型，“翻译”成对应的操作指令发给具体的文件系统驱动。
    * **目的:** 屏蔽底层不同文件系统的差异，使用户程序可以用同样的方式操作任何文件系统的文件。

---
第四章的内容与实际使用联系紧密，通过“图书馆”这个核心比喻，可以将文件、目录、FCB/inode、打开/关闭等概念串联起来。计算题主要集中在索引文件大小和位示图定位，掌握模板即可轻松应对。祝大家复习顺利！
</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
