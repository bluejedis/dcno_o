
# above  

<ul>

#  

<ul>

## 【考纲内容】  

<ul>

（一）操作系统的基本概念  

（二）操作系统的发展历程  

（三）程序运行环境  

CPU运行模式：内核模式与用户模式：中断和异常的处理：系统调用：程序的链接与装入：程序运行时内存映像与地址空间  

（四）操作系统结构分层、模块化、宏内核、微内核、外核  

（五）操作系统引导  

（六）虚拟机  

</ul>

## 【复习提示】  

<ul>

常以选择题的形式考查，重点考查操作系统的功能、运行环境和提供的服务。

要求：
- 宏观：操作系统各部分的功能
- 微观：细微的知识点

thus，复习操作系统时，首先要形成大体框架，并通过反复复习和做题巩固知识体系，然后将操作系统的所有内容串成一个整体。

本章的内容有助于读者整体上初步认识操作系统，为后面掌握各章节的知识点奠定基础，moreover整体把握课程，不要因为本章的内容在历年考题中出现的比例不高而忽视它。  

</ul>

</ul>

# 基本概念  

<ul>

## 概念  
<ul>
- 操作系统（OperatingSystem，OS）
  - 控制和管理整个计算机系统的硬件与软件资源
  - 合理地组织、调度计算机的工作与资源的分配
  - moreover为用户和其他软件提供方便接口与环境的**程序集合**

- OS：计算机系统中 最**基本** 的 系统软件
- 计算机系统(自下而上)
  - 硬件
  - **OS**
    - 管理各种计算机硬件，为应用程序提供**基础**，并且充当计算机硬件与用户之间的**中介** 
    - 控制和协调各用户的应用程序对硬件的分配与使用，提供了正确使用这些资源的**方法**  
  - 应用程序和用户
  
  （这里的划分与 计算机组成原理中的分层不同）

</ul>

---

<ul>

硬件（中央处理器、内存、输入/输出设备等）提供基本的**计算资源**

应用程序（字处理程序、电子制表软件、编译器、网络浏览器等）规定按何种**方式**使用这些资源来解决用户的计算问题

</ul>

## 特征/基本特征 

<ul>

操作系统是一种**系统软件**，但与其他系统软件和应用软件有很大的不同，它有自己的特殊性即基本特征。
  
### 并发（Concurrence）  

<ul>

#### 定义
- 两个或多个事件在同一时间间隔内发生

#### 多道程序环境
- 特点：
  - 内存中同时装有若干道程序
  - 利用程序I/O操作暂停时的CPU空档时间
  - 调度另一道程序运行
  - 实现多道程序交替运行
  - 使CPU保持忙碌状态

>pro：并行性的定义及分析（2009）  

#### 并行性
- 定义：在同一时刻能完成两种或两种以上的工作
- 特征：同时进行运算或操作的特性

#### 单处理机多道程序环境
- 宏观：多道程序同时执行
- 微观：程序分时交替执行
- 实现方式：
  - 并发通过分时实现
  - CPU与I/O设备、I/O设备间可实现真正并行
  - 进程并行需要硬件支持（多流水线或多处理机）

>attention：同一时间间隔（并发）和同一时刻（并行）的区别

#### 示例说明
- eg：在9:00一9:10仅吃面包，在9:10一9:20仅写字，在9:20一9:30仅吃面包，在9:30一10:00仅写字，那么在9:00一10:00吃面包和写字这两种行为就是并发执行的：再如，如果你在9：00一10：00右手写字，左手同时拿着面包吃，那么这两个动作就是并行执行的。  

#### 进程引入目的
- 使程序能并发执行

</ul>

### 共享（Sharing）  

<ul>

#### 定义
- 系统资源可供内存中多个并发执行的进程共同使用
- 分类：
  - 互斥共享
  - 同时访问

#### 互斥共享方式  
##### 特点
- 一段时间内只允许一个进程访问资源
- 适用资源：
  - 打印机
  - 磁带机
  - 栈
  - 变量
  - 表格

##### 访问流程
- 进程提出请求
- 系统检查资源状态
- 资源分配与使用
- 其他进程等待
- 资源释放后允许其他进程访问

#### 同时访问方式  
##### 特点
- 允许多个进程"同时"访问
- 宏观同时，微观交替
- 适用资源：
  - 磁盘设备
  - 重入代码编写的文件

#### 并发与共享关系
- 互为存在条件：
  - 资源共享以程序并发为条件
  - 资源共享管理影响程序并发执行

</ul>

### 虚拟（Virtual)  

<ul>

#### 定义
- 将物理实体变为逻辑对应物
- 实现技术：
  - 时分复用技术
  - 空分复用技术

#### 虚拟技术应用
##### 虚拟处理器
- 通过多道程序设计技术
- 分时使用处理器
- 为多用户提供服务

##### 虚拟存储器
- 扩充存储器逻辑容量
- 提供用户感知的虚拟容量

##### 虚拟设备
- 物理I/O设备虚拟为多台逻辑设备
- 实现临界资源的共享访问

</ul>

### 异步（A synchro n is m）  

<ul>

#### 特征
- 多道程序并发执行
- 进程执行非连续性
- 推进速度不可预知

#### 影响
- 可能导致时间相关错误
- 相同运行环境下需保证结果一致性

</ul>

</ul>

## 目标和功能  

<ul>

### 操作系统作为计算机系统资源的管理者  

<ul>

#### 处理机管理  
- 多道程序环境下的管理特点：
  - 以进程(或线程)为基本单位进行分配和运行
  - 并发运行多个进程
- 主要管理任务：
  - 进程创建与撤销时机
  - 进程管理方式
  - 冲突避免
  - 合理共享
- 核心功能：
  - 进程控制
  - 进程同步
  - 进程通信
  - 死锁处理
  - 处理机调度

#### 存储器管理  
- 管理目标：
  - 为多道程序提供良好运行环境
  - 方便用户使用
  - 提高内存利用率
- 主要功能：
  - 内存分配与回收
  - 地址映射
  - 内存保护与共享
  - 内存扩充

#### 文件管理  
- 基本概念：
  - 计算机信息以文件形式存在
  - 负责管理的部分称为文件系统
- 管理内容：
  - 文件存储空间管理
  - 目录管理
  - 文件读写管理和保护

#### 设备管理  
- 主要任务：
  - 完成用户I/O请求
  - 方便用户使用各种设备
  - 提高设备利用率
- 核心功能：
  - 缓冲管理
  - 设备分配
  - 设备处理
  - 虚拟设备

</ul>

### 操作系统作为用户与计算机硬件系统之间的接口  

<ul>

#### 命令接口  
##### 联机命令接口
- 特点：
  - 又称交互式命令接口
  - 适用于分时或实时系统
  - 由键盘操作命令组成
- 工作流程：
  - 用户通过控制台输入命令
  - 命令解释程序解释执行
  - 完成指定功能后返回控制权

##### 脱机命令接口
- 特点：
  - 又称批处理命令接口
  - 适用于批处理系统
  - 由作业控制命令组成
- 工作方式：
  - 用户提前准备作业操作说明书
  - 系统调度执行时逐条解释执行
  - 间接控制作业运行

#### 程序接口  
>pro：操作系统为应用程序提供的接口（2010）  

- 组成：
  - 由系统调用(广义指令)组成
- 功能：
  - 请求操作系统服务
  - 使用外部设备
  - 申请分配和回收内存

##### 图形用户界面(GUI)
- 特点：
  - 当前最流行的接口形式
  - 通过程序接口实现
  - 支持鼠标和键盘操作
- 性质：
  - 不是操作系统的一部分
  - 系统调用命令属于操作系统

</ul>

### 操作系统实现了对计算机资源的扩充  
<ul>
- 裸机概念：
  - 无软件支持的计算机
  - 构成计算机系统的物质基础
- 扩充机器特点：
  - 经过软件改造的计算机系统
  - 操作系统提供资源管理功能
  - 提供方便用户的服务功能
  - 也称为虚拟机
  
</ul>

</ul>

</ul>

# 发展历程  

<ul>

## 手工操作阶段（此阶段无操作系统）
<ul>
- 操作特点：
  - 用户在计算机上算题的所有工作都要人工干预
  - 如程序的装入、运行、结果的输出等
- 问题：
  - 随着计算机硬件的发展，人机矛盾越来越大
  - 必须寻求新的解决办法
- 主要缺点：
  - 用户独占全机
    - 不会出现因资源已被其他用户占用而等待的现象
    - 但资源利用率低
  - CPU等待手工操作，CPU的利用不充分
- 解决方案：
  - 用高速的机器代替相对较慢的手工操作来对作业进行控制

</ul>

## 批处理阶段（操作系统开始出现）
<ul>
- 产生原因：
  - 解决人机矛盾及CPU和I/O设备之间速度不匹配的矛盾
- 发展阶段：
  - 单道批处理系统
  - 多道批处理系统（多道程序设计技术出现以后）

>pro：批处理系统的特点（2016）

### 单道批处理系统
<ul>
- 实现方式：
  - 先将一批作业以脱机方式输入磁带
  - 配上监督程序（Monitor）
  - 在其控制下批量处理作业
- 主要特征：
  - 自动性
    - 磁带上的一批作业能自动地逐个运行
    - 无须人工干预
  - 顺序性
    - 磁带上的各道作业顺序地进入内存
    - 先调入内存的作业先完成
  - 单道性
    - 内存中仅有一道程序运行
    - 监督程序每次从磁带上只调入一道程序
    - 程序完成或异常时才换入后继程序
- 存在问题：
  - 每次内存中仅存放一道作业
  - CPU需等待I/O完成，资源利用率低

</ul>

### 多道批处理系统
<ul>
- 工作原理：
  - 作业先存放在外存并排队
  - 作业调度程序选择作业调入内存
  - 多个作业在管理程序控制下穿插运行
  - 共享系统硬软件资源

>pro：多道批处理系统的特点（2017、2018、2022）

#### 多道程序设计特点
- 多道
  - 内存中同时存放多道相互独立的程序
- 宏观上并行
  - 多道程序同时处于运行过程中
  - 但都未运行完毕
- 微观上串行
  - 多道程序轮流占有CPU
  - 交替执行

#### 实现问题
- 处理器分配
- 多道程序内存分配
- IO设备分配
- 程序和数据的组织存放

#### 系统评价
- 优点：
  - 资源利用率高
  - 系统吞吐量大
- 缺点：
  - 用户响应时间较长
  - 不提供人机交互能力

>attention:  2018年真题考查的多任务操作系统可视为具有交互性的多道批处理系统。

</ul>

</ul>

## 分时操作系统
<ul>
- 基本概念：
  - 将处理器运行时间分成短时间片
  - 按时间片轮流分配给各联机作业
- 系统特点：
  - 多个用户通过终端同时共享主机
  - 用户可同时交互操作互不干扰
- 主要特征：
  - 同时性（多路性）
    - 允许多个终端用户同时使用
  - 交互性
    - 用户通过终端直接控制程序运行
  - 独立性
    - 多个用户彼此独立操作
    - 互不干扰
  - 及时性
    - 用户请求能快速获得响应

</ul>

## 实时操作系统
<ul>
- 系统目的：
  - 在时间限制内完成紧急任务
  - 无需时间片排队
- 系统分类：
  - 硬实时系统
    - 必须在规定时刻完成任务
    - 如飞行器自动控制系统
  - 软实时系统
    - 可接受偶尔违反时间规定
    - 如飞机订票系统、银行管理系统
- 主要特点：
  - 及时性
  - 可靠性

</ul>

## 网络操作系统和分布式计算机系统
<ul>
### 网络操作系统
<ul>
- 主要功能：
  - 结合网络中各台计算机
  - 提供统一使用方法
  - 实现数据互传
- 主要特点：
  - 资源共享
  - 计算机间通信

</ul>

### 分布式计算机系统
<ul>
- 系统条件：
  - 计算机间通过通信交换信息
  - 计算机地位平等
  - 资源共享
  - 可构成子系统且能重构
  - 工作可并行协同完成
- 主要特点：
  - 分布性
  - 并行性

</ul>

</ul>

## 个人计算机操作系统
<ul>
- 应用范围：
  - 文字处理
  - 电子表格
  - 游戏
- 常见系统：
  - Windows
  - Linux
  - MacOS

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f0b0a74fe593824117427da27a54272d9549040a746ec72171a717ad41491567.jpg)
图1.1操作系统的发展历程

- 其他类型：
  - 嵌入式操作系统
  - 服务器操作系统
  - 智能手机操作系统

</ul>

</ul>

# 运行环境  

<ul>

## 处理器运行模式

<ul>

### CPU执行程序分类
<ul>
- 操作系统内核程序
- 用户自编程序（系统外层应用程序）
  - 两者作用不同：
    - 内核程序是管理者
    - 用户程序是被管理者
  - 区别：
    - 内核程序可执行特权指令
    - 用户程序不能执行特权指令

>pro：特权指令和非特权指令的特点（2022）  

#### 指令类型
##### 特权指令
- 不允许用户直接使用
- 包括：
  - I/O指令
  - 关中断指令
  - 内存清零指令
  - 存取内存保护寄存器
  - 送PSW到程序状态字寄存器等

##### 非特权指令
- 允许用户直接使用
- 特点：
  - 不能直接访问系统软硬件资源
  - 仅限访问用户地址空间

>pro：内核态执行的指令分析（2021）  

</ul>

#### CPU运行模式实现
<ul>
>pro：用户态发生或执行的事件分析（2011、2012、2014）  
- 分为用户态和核心态
  - 通过CPU内部开关控制：
    - 0：核心态，可执行特权指令
    - 1：用户态，只能执行非特权指令
  - 应用场景：
    - 应用程序运行在用户态
    - 操作系统内核程序运行在核心态
    - 通过访管指令请求服务

</ul>

</ul>

### 现代操作系统结构
<ul>

#### 分层结构
<ul>
- 最低层：
  - 时钟管理
  - 中断处理
  - 设备驱动
- 次低层：
  - 进程管理
  - 存储器管理
  - 设备管理
- 以上两层构成操作系统内核，运行在核心态

</ul>

#### 内核功能
<ul>

##### 时钟管理

<ul>

>pro：时钟中断服务的内容（2018）  

- 主要功能：
  - 计时，提供标准系统时间
  - 通过时钟中断实现进程切换
  - 支持各类调度方式：
    - 分时系统的时间片轮转
    - 实时系统的截止时间控制
    - 批处理系统的运行度量

</ul>

##### 中断机制

<ul>

>pro：中断机制在多道程序设计中的作用（2016）  

- 目的：提高CPU利用率
- 应用领域：
  - 输入输出控制
  - 进程管理调度
  - 系统功能调用
  - 设备驱动
  - 文件访问
- 内核部分职责：
  - 保护中断现场信息
  - 恢复中断现场信息
  - 转移控制权

</ul>

##### 原语

<ul>

- 特点：
  - 位于系统底层
  - 操作具有原子性
  - 运行时间短且调用频繁
- 实现方法：
  - 关中断实现
  - 应用领域：
    - 设备驱动
    - CPU切换
    - 进程通信

</ul>

##### 系统控制的数据结构及处理

<ul>

- 系统状态数据结构：
  - 作业控制块
  - 进程控制块(PCB)
  - 设备控制块
  - 各类链表
  - 消息队列
  - 缓冲区
  - 空闲区登记表
  - 内存分配表
- 基本操作类型：
  - 进程管理
    - 状态管理
    - 调度分派
    - 控制块操作
  - 存储器管理
    - 空间分配回收
    - 内存保护
    - 代码对换
  - 设备管理
    - 缓冲区管理
    - 设备分配回收

</ul>

</ul>

</ul>

</ul>

## 中断和异常的概念

<ul>

>pro：用户态切换到内核态的事件分析（2013、2015）  

### 状态切换机制
<ul>
- 通过中断或异常实现用户态到核心态的切换
- 硬件实现方式：
  - 特殊寄存器位控制
    - 0表示核心态
    - 1表示用户态

</ul>

### 基本定义

<ul>

>pro：可能引发中断或异常的指令分析（2013、2015）  

#### 中断(外中断)
- 来自CPU外部事件
- 主要用于：
  - I/O结束中断
  - 时钟中断

#### 异常(内中断)
- 来自CPU内部事件
- 触发情况：
  - 非法操作码
  - 地址越界
  - 运算溢出
  - 缺页
  - 陷入指令

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/493ee587aa4ea7134d5b43927f04c9c39d6157c05d4d8a3e96ba9bbf2dad9e75.jpg)  
图1.2内中断和外中断的联系与区别  

</ul>

### 分类系统

<ul>

>pro：中断和异常的分类（2016）  

#### 外中断分类
- 可屏蔽中断
  - 通过INTR线发出
  - 可通过屏蔽字实现多重中断
- 不可屏蔽中断
  - 通过NMI线发出
  - 用于处理紧急硬件故障

#### 异常分类
- 故障(Fault)
  - 指令执行引起
  - 包括：
    - 非法操作码
    - 缺页故障
    - 除数为0
    - 运算溢出
- 自陷(Trap)
  - 预先安排的异常
  - 用于：
    - 条件陷阱指令
    - 系统调用指令
- 终止(Abort)
  - 硬件故障导致
  - 如：
    - 控制器出错
    - 存储器校验错

</ul>

### 处理流程

<ul>

>pro：中断和异常的处理过程（2015、2020、2024）  

- 基本流程：
  - 检测到中断/异常
  - 打断当前程序
  - 转入处理程序
  - 处理完成后返回

>pro：中断处理和子程序调用的比较（2012）  

#### 与子程序调用的区别
- 关系性质：
  - 中断处理与被中断程序相互独立
  - 子程序与主程序是主从关系
- 触发方式：
  - 中断随机产生
  - 子程序通过CALL指令调用
- 处理过程：
  - 中断需要硬件支持
  - 子程序纯软件处理
- 入口地址确定：
  - 中断通过硬件向量法
  - 子程序由CALL指令指定
- 程序计数器保护：
  - 中断由隐指令完成
  - 子程序由CALL指令完成
- 响应机制：
  - 中断需要多重请求裁决
  - 子程序无需裁决
</ul>

</ul>

## 系统调用  

<ul>

>pro：系统调用的定义及性质（2019、2021）  

### 定义与性质
<ul>
- 系统调用是用户程序调用操作系统提供的子功能
  - 可视为特殊的公共子程序
  - 共享资源由操作系统统一管理
  - 资源相关操作必须通过系统调用请求服务
- 系统调用特点
  - 每个调用有唯一系统调用号
  - 数量可达几十到上百条
  - 按功能分类

>pro：系统调用的功能（2021）  

</ul>

### 功能分类
<ul>
- 设备管理
  - 设备的请求或释放
  - 设备启动
- 文件管理
  - 文件的读写
  - 文件的创建及删除
- 进程控制
  - 进程的创建、撤销
  - 进程的阻塞及唤醒
- 进程通信
  - 进程间消息传递
  - 信号传递
- 内存管理
  - 内存的分配、回收
  - 获取作业内存信息

</ul>

### 处理要求
<ul>
- 由操作系统内核程序负责
- 运行在核心态
- 原因：涉及系统资源和进程管理

>pro：系统调用的处理过程及CPU状态的变化（2012、2017、2023）  

>pro：系统调用处理过程中操作系统负责的任务（2022）  

</ul>

### 处理过程
<ul>

#### 第一步：准备阶段
- 用户程序操作
  - 将系统调用号和参数压入堆栈
  - 执行调用指令和陷入指令
- 状态转换
  - CPU从用户态转为核心态
- 现场保护
  - 保存PC、PSW及通用寄存器内容

#### 第二步：处理阶段
- 分析系统调用类型
- 查找系统调用入口表
- 转入对应处理子程序

#### 第三步：恢复阶段
- 恢复CPU现场
- 返回继续执行

</ul>

### CPU状态变化理解
<ul>
- 陷入指令作用
  - CPU使用权交给内核程序
  - 状态从用户态进入核心态
- 处理完成后
  - CPU使用权返回用户程序
  - 状态从核心态回用户态
- 设计目的
  - 限制用户程序直接执行关键操作
  - 保证系统稳定性和安全性

</ul>

### 运行环境说明
<ul>
- 基本流程
  - 用户通过操作系统运行上层程序
  - 上层程序依赖底层管理程序服务
  - 需要服务时通过中断进入核心态
  - 异常情况通过异常处理进入核心态
  - 处理完成后返回断点继续执行

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b1906f3c0ca66238f8d17735d697a2137fc1f07f9548f85837ea5f14001eeb54.jpg)  
图1.3系统调用执行过程  

</ul>

### 状态转换示例
<ul>

#### 用户态转向核心态
- 系统调用请求服务
- 中断发生
- 程序产生错误状态
- 企图执行特权指令

#### 核心态转向用户态
- 通过中断返回指令实现
- 该指令为特权命令
 
</ul>

</ul>

### 操作系统结构
<ul>

#### 背景
<ul>
- 操作系统功能不断增多
- 代码规模不断扩大
- 合理结构的重要性
  - 降低操作系统复杂度
  - 提升操作系统安全与可靠性

</ul>

#### 分层法
<ul>

##### 基本概念
- 操作系统分为若干层
  - 底层(层0)为硬件
  - 顶层(层N)为用户接口
  - 每层只能调用紧邻低层的功能和服务(单向依赖)

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/81bbbd88798a995473d2b6d27deb4a915fcfcbafc635c31bcc01aff7f13f3a14.jpg)  
图1.4分层的操作系统  

##### 优点
- 便于系统调试和验证
  - 简化系统设计和实现
  - 逐层调试验证
  - 错误定位容易
- 易扩充和维护
  - 模块增删改不影响其他层
  - 保持接口不变即可

##### 问题
- 合理定义各层困难
  - 依赖关系固定后不够灵活
- 效率较差
  - 功能执行需穿越多层
  - 层间通信机制增加开销

</ul>

#### 模块化
<ul>

##### 基本概念
- 按功能划分为独立模块
- 规定模块间接口
- 通过接口进行通信
- 可细分为子模块

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/66329b0f96d29e529b392be4dd0882f9c485466dfcef3858e75c9ac55e961c55.jpg)  
图1.5由模块、子模块等组成的模块化操作系统结构  

##### 模块划分考虑
- 模块大小权衡
  - 太小：模块间联系过多
  - 太大：内部复杂性增加
- 模块独立性标准
  - 内聚性：模块内部联系紧密程度
  - 耦合度：模块间相互影响程度

##### 优缺点
###### 优点
- 提高系统设计质量
  - 正确性
  - 可理解性
  - 可维护性
- 增强可适应性
- 加速开发过程

###### 缺点
- 接口规定难满足实际需求
- 设计决策顺序难确定

</ul>

#### 宏内核
<ul>

##### 基本概念
- 主要功能模块在核心态运行
- 为用户程序提供高性能服务
- 管理模块间共享信息

##### 发展现状
- 主流地位
  - Windows、Android、iOS等采用
- 面临挑战
  - 系统服务复杂化
  - 设计规模增长
  - 软件危机困境

##### 与微内核关系
- 同步发展
- 形成混合内核
  - 吸收微内核优点
  - 融合成新架构
- 未来趋势
  - 微内核优势显现
  - Fuchsia和鸿蒙OS采用微内核
</ul>

</ul>

## 微内核  

<ul>

### 基本概念  

<ul>

#### 定义
- 将内核中最基本的功能保留在内核
- 不需要在核心态执行的功能移到用户态执行
- 降低内核的设计复杂性
- 移出内核的操作系统代码
  - 按分层原则划分为若干服务程序
  - 执行相互独立
  - 通过微内核进行通信

#### 结构组成
- 微内核和多个服务器构成
- 微内核包含
  - $\textcircled{\scriptsize{1}}$ 与硬件处理紧密相关的部分
  - $\textcircled{2}$ 一些较基本的功能
  - $\textcircled{3}$ 客户和服务器之间的通信
- 大部分功能在微内核外服务器中实现
  - 作为进程运行在用户态
  - 通过消息传递机制交互

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8a2da0b5134ea9c29a2947ba9281d8adcfa2f6cfc1e46a2266262f4d7a0725ec.jpg)  
图1.6单机环境下的客户/服务器模式  

#### 运行方式
- 只有微内核运行在内核态
- 其余模块运行在用户态
- 错误隔离机制
  - 单模块错误只导致该模块崩溃
  - 不影响整个系统

</ul>

### 基本功能  

<ul>

#### 设计原则
- 利用"机制与策略分离"原理
- 机制部分和硬件相关部分放入微内核

#### 核心功能
##### 进程管理
- 进程通信功能
- 进程切换和调度
- 多处理机同步
- 机制与策略分离示例
  - 机制：优先级队列设置
  - 策略：进程分类和优先级确定

##### 存储器管理
- 基本机制
  - 页表机制
  - 地址变换机制
- 策略部分放在外部服务器
  - 页面置换算法
  - 内存分配回收策略

##### 中断处理
- 捕获中断和陷入事件
- 进行中断响应
- 转发给相关服务器

</ul>

### 特点  

<ul>

>pro：微内核操作系统的特点（2023）  

#### 优点
- $\textcircled{\scriptsize{1}}$ 扩展性和灵活性
  - 功能模块化分离
  - 易于修改和增加功能
- $\circledcirc$ 可靠性和安全性
- $\textcircled{3}$ 可移植性
  - 硬件相关代码集中在内核
  - 服务器与平台无关
- $\textcircled{4})$ 分布式计算支持
  - 基于消息传递机制
  - 适合分布式和网络系统

#### 缺点
- 性能问题
  - 频繁模式切换
  - 执行开销大
- 改进措施
  - 常用服务移回内核
  - 但会增加内核体积

#### 应用领域
- 实时系统
- 工业应用
- 航空军事
- 关键任务系统

</ul>

</ul>

## 外核  

<ul>

### 基本原理
<ul>
- 资源划分策略
  - 给每个用户分配资源子集
  - 例如磁盘块分配

</ul>

### 核心功能
<ul>
- 运行在内核态
- 资源分配
- 使用安全检查
- 虚拟机限制管理

</ul>

### 优势
<ul>
- 减少资源映射层
- 简化重映射处理
- 分离多道程序和用户操作系统代码
- 负载较轻

</ul>

#### 引导  

<ul>
- 操作系统（如Windows、Linux等）是一种程序
  - 程序以数据的形式存放在硬盘中
  - 硬盘通常分为多个区
  - 一台计算机中可能有多个或多种外部存储设备
- 操作系统引导过程
  - 计算机利用CPU运行特定程序
  - 通过程序识别硬盘
  - 识别硬盘分区
  - 识别硬盘分区上的操作系统
  - 最后通过程序启动操作系统

>pro：操作系统的引1导过程（2021）  

##### 常见操作系统的引导过程
- $\textcircled{\scriptsize{1}}$ 激活CPU
  - 激活的CPU读取ROM中的boot程序
  - 将指令寄存器置为BIOS的第一条指令
  - 开始执行BIOS的指令

>pro：操作系统引|导过程中创建的数据结构（2022）  

- $\circledcirc$ 硬件自检
  - BIOS程序在内存构建中断向量表
  - 进行通电自检
    - 检查硬件是否出现故障
    - 如有故障，主板发出蜂鸣，启动中止
    - 如无故障，显示系统信息

- $\textcircled{3}$ 加载带有操作系统的硬盘
  - BIOS读取BootSequence
  - 将控制权交给首位存储设备
  - CPU加载引导扇区内容到内存

- $\textcircled{4}$ 加载主引导记录（MBR）
  - 通过标识符区分引导硬盘
  - 检查可引导设备
  - MBR指示CPU寻找操作系统位置

- $\circledast$ 扫描硬盘分区表和加载活动分区
  - MBR包含硬盘分区表
  - 识别含有操作系统的活动分区
  - 加载活动分区并交接控制权

- $\circledcirc$ 加载分区引导记录（PBR）
  - 读取活动分区第一个扇区
  - 寻找并激活引导程序

- $\textcircled{\scriptsize{2}}$ 加载启动管理器
  - 分区引导记录搜索启动管理器
  - 加载启动管理器

>pro：操作系统运行的存储器（2013）  

- $\textcircled{8}$ 加载操作系统
  - 将操作系统初始化程序加载到内存执行

</ul>

</ul>

#### 虚拟机  

<ul>

##### 基本概念  
<ul>
- 虚拟机定义
  - 利用虚拟化技术将物理机器虚拟化为多台虚拟机器
  - 隐藏实际物理特性
  - 提供抽象、统一、模拟的计算环境

</ul>

##### 第一类虚拟机管理程序  
<ul>
- 特点
  - 运行在最高特权级
  - 在裸机上运行
  - 具备多道程序功能
- 功能
  - 向上层提供虚拟机
  - 虚拟机是裸机硬件的精确复制品
  - 可运行不同操作系统

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f153beca1806b80b27f1db8ca4a28efeb5e9e92f2caa6875b46354245569316d.jpg)  
图1.7两类虚拟机管理程序在系统中的位置  

- 运行机制
  - 虚拟机作为用户态进程运行
  - 不允许执行敏感指令
  - 虚拟内核态的概念
  - 指令执行控制
    - 支持虚拟化的CPU处理方式
    - 不支持虚拟化的CPU处理方式

</ul>

##### 第二类虚拟机管理程序  
<ul>
- 特征
  - 依赖于主操作系统
  - 类似普通进程
  - 模拟完整计算机环境

- 系统组成
  - 客户操作系统
  - 宿主操作系统
  - 虚拟设备管理

- 应用场景
  - Web主机服务
  - 云主机服务
    - 相比共享托管和独占托管的优势
    - 资源利用效率

- 命名说明
  - 第一类：裸金属架构
  - 第二类：寄居架构

</ul>

##### 功能分层设计
<ul>
- 微内核OS的四个特点
  - $\textcircled{\scriptsize{1}}$ 内核足够小
  - $\textcircled{2}$ 基于客户/服务器模式
  - $\textcircled{3}$ 应用"机制与策略分离"原理
  - $\textcircled{4}$ 采用面向对象技术
  
</ul>

</ul>

</ul>

# 本章疑难点  

<ul>

### 并行性与并发性的区别和联系
<ul>

#### 基本概念
- 并行性和并发性是既相似又有区别的两个概念
  - 并行性：两个或多个事件在同一时刻发生
  - 并发性：两个或多个事件在同一时间间隔内发生

#### 多道程序环境下的体现
- 并发性表现
  - 宏观：多个程序同时运行
  - 微观：在单处理器系统中分时交替执行
- 并行性实现
  - 多处理器系统中将并发程序分配到不同处理器
  - 每个处理器处理一个可并发执行的程序

</ul>

### 特权指令与非特权指令
<ul>

#### 特权指令的特点
- 具有特殊权限的指令
- 使用不当可能导致系统崩溃
- 必须在核心态执行
- 包括清内存、置时钟等系统级操作

#### 指令使用的权限控制
- 用户态限制
  - 只能使用非特权指令
  - 使用特权指令会产生中断
- 核心态权限
  - 可以执行指令系统的全集
  - 是系统安全性和可靠性的保证
- 状态转换
  - 从用户态转换为核心态的唯一途径是中断或异常

</ul>

### 访管指令与访管中断
<ul>

#### 访管指令的定义与作用
- 可在用户态执行的指令
- 用于请求操作系统服务
- 产生访管中断（自愿中断）

#### 引入访管指令的必要性
- 解决用户程序在用户态下无法完成的工作
- 提供"自愿进管"的手段
- 通过访管中断实现向操作系统请求服务

</ul>

### 定义微内核结构OS的四个方面
<ul>

#### 核心特征
- 足够小的内核

#### 架构模式
- 基于客户/服务器模式

#### 设计原则
- 应用"机制与策略分离"原理
  - 机制：实现功能的具体执行机构
  - 策略：基于机制实现功能优化的参数和算法
  - 传统OS：机制在低层，策略在高层
  - 微内核OS：机制放在微内核中

#### 技术实现
- 采用面向对象技术
  - 基于"抽象"和"隐蔽"原则控制系统复杂性
  - 利用"对象""封装"和"继承"确保系统特性
  - 广泛应用于现代操作系统设计

</ul>

</ul>
